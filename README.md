# test-task

API представленно в виде классов flask restful.
Так как в задании не было информации о том, может ли быть логика работы сервера разделена на несколько файлов, весь код, работающий с бд, так же находится в tt_script.py.

# API

Все методы API возвращают информацию в формате JSON.
Всего скрипт содержит 4 класса:
1. Класс GeoObject: эндпоинт - '/<int:geonameid>' объекта, возвращает информацию об объекте с этим id. GET-запрос принимает в качестве аргумента geonameid объекта и возвращает результат работы функции get_object_from_db(geonameid).
2. Класс GeoSearch: эндпоинт - '/' , возвращает информацию о нескольких объектах. GET-запрос принимает в качестве аргументов page - номер страницы, и rows - количество отображаемых на странице объектов (стандартные значения: page=1, rows=20), возвращает результат работы функции get_rows_from_db(page, rows).
3. Класс GeoCompare: эндпоинт - '/compare', возвращает информацию о двух объектах и о результате их сравнения. GET-запрос принимает в качестве аргументов first_name - имя первого объекта на кириллице, и second_name - имя второго объекта на кириллице, транслитерирует их на английское написание с помощью модуля transliterate, возвращает результат работы функции get_objects_by_name(first_name, second_name).
4. Класс GeoGlossary: эндпоинт - '/glossary', возвращает список имен объектов на кириллице. GET-запрос принимает в качестве аргумента name - часть названия объекта на кириллице, транслитерирует его на английское написание с помощью модуля transliterate, возвращает результат работы функции get_whole_name(name).

# get_object_from_db(geonameid)

Подключается к базе данных и выполняет поиск записи с искомым geonameid. Возвращает одну найденную запись базы данных. В случае если ни одной подходящей записи не было найдено или не был передан аргумент, возвращается ошибка.

# get_rows_from_db(page, rows)

Подключается к базе данных и выполняет поиск наименьшего значения geonameid - min_geonameid, после чего выполянет поиск записей с geonameid между ((page-1)\*rows)+min_geonameid и (page\*rows)+min_geonameid. Возвращает список из всех найденных записей базы данных. В результате возвращается страница с номером page, содержащая rows объектов. В случае если ни одной подходящей записи не было найдено или не были переданы аргументы, возвращается ошибка.

# get_objects_by_name(first_name, second_name)

Подключается к базе данных и выполняет поиск записей с искомыми именами по полю asciiname, сортируемых по полю population, после чего с помощью модуля zoneinfo определяет их временные зоны и сравнивает их, если они различны то так же считает разницу во времени, плюс определяет какой из них расположен севернее по широте. Возвращает словарь, содержащий информацию в виде словарей о первом и втором городе и результате их сравнения. В случае если ни одной подходящей записи не было найдено или не были переданы аргументы, возвращается ошибка.

# get_whole_name(name)

Подключается к базе данных и выполняет поиск записей по полю asciiname по регулярному выражению name + '%', сортируемых по полю population, после чего транслитерирует поле asciiname найденных записей на кириллицу. Возвращает список имен объектов на кириллице. В случае если ни одной подходящей записи не было найдено или не были переданы аргументы, возвращается ошибка.

# Другие функции

* get_db() - проверяет, подключен ли сервер к базе данных и подключает если нет.
* close_db() - отключает сервер от базы данных и закрывает соединение с ней.
* init_db() - парсит файл RU.txt и инициализирует базу данных.
* init_app(app) - настраивает работу сервера с фанкцией close_db(e=None) и проверяет наличие файла базы данных, если он отсутствует - вызывает init_db().
* create_app() - начальная настройка сервера.
